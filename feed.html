<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>
		야옹아밥먹자
	</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
	<style type=text/css>
		@font-face {
		    font-family: 'DosSammul';
		    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_eight@1.0/DOSSaemmul.woff') format('woff');
		    font-weight: normal;
		    font-display: swap;
		}
		html{font-size: 2rem;scroll-behavior: smooth;}
		body,h1,h2,h3,p,ol,ul{margin:0;padding:0;}
		h1{font-family: "Jersey 10", sans-serif;font-weight: 400;font-style: normal; font-size: 4rem; text-align: center;padding: 200px 0px 20px 0px;text-shadow: 7px 7px 0 white,-7px -7px 0 white, 7px -7px 0 white,-7px 7px 0 white; filter: drop-shadow(5px 5px 0 #73564b);z-index: 999;position:relative;}
		h3{font-family: 'DosSammul', sans-serif;font-weight: 400;font-style: normal; font-size: 1rem; text-align: center;padding-bottom:70px;text-shadow: 2px 2px 0 white,-2px -2px 0 white, 2px -2px 0 white,-2px 2px 0 white; filter: drop-shadow(2px 2px 0 #73564b);z-index: 999;position:relative;}
		.wrap {width:1500px;margin:auto;align-items: center;}
		.bg {background: url(bg.jpg) no-repeat center center fixed;background-size: cover;overflow-x:hidden;}
		 #overlay {
		    display: none;
		    position: fixed;
		    top: 0;
		    left: 0;
		    width: 100%;
		    height: 100%;
		    background: rgba(0,0,0,0.6);
		    z-index: 999;
		  }
		#rulePopup {
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 620px;
			background: white;
			border: 5px solid black;
			box-shadow: 6px 6px 0 #333;
			padding: 50px 30px;
			font-family: 'DosSammul';line-height: 1.3rem;
			font-size: 0.7rem;
			color: black;
			z-index: 1000;
		}
		#rulePopup h2 {
			text-align: center;
			margin-bottom: 60px;font-size: 1.8rem;
		}
		#rulePopup ul {
			text-align: left;
			padding-left: 20px;
		}
		#rulePopup button {
			display: block;
			margin: 40px auto 0 auto;
			padding: 15px 15px;
			border: 3px solid black;
			background: white;
			font-family: 'DosSammul';font-size: 0.5rem;
			cursor: pointer;filter:drop-shadow(3px 3px 0 #555);;
		}
		#rulePopup button:hover {
			background: black;
			color: white;
		}
		#gameUI {display:none;}
	    #timer {
	      position:absolute;top:40px;right:40px;z-index: 99;
	      font-family:"Jersey 10",sans-serif;font-size:2rem;
	      text-shadow:3px 3px 0 white,-3px -3px 0 white,3px -3px 0 white,-3px 3px 0 white;
	    }
	    #hearts {
	      position:absolute;top:50px;left:40px;z-index: 9999;
	    }
	    #hearts img {width:60px;margin-right:5px;}
	    #cat {position:absolute;bottom:180px;left:50%;transform:translateX(-50%);width:200px;}
	    .item {
	      position:absolute;top:-50px;width:60px;z-index: 99}
	</style>
</head>
<body class="bg">
	<h1 id="title">
		Feed the Cat!
	</h1>
	<h3>
		야옹이의 밥시간이에요!
	</h3>
	<div style="text-align: center;">
		<img src="standingcat2.jpg" id="startCat" style="width: 500px;bottom:180px;cursor: pointer;padding-top:40px" onclick="showRules()">
	</div>
	<div id="overlay"></div>
	<div id="rulePopup">
		<h2>!Rule!</h2>
		<ul>
			<li>방향키(←, →)와 스페이스바로 야옹이를 조작할 수 있다.</li>
			<li>떨어지는 생선을 먹으면 점수를 얻는다.</li>
			<li>그러나 플라스틱 병이나 쓰레기는 먹으면 하트가 깎임!</li>
			<li>우측 상단 타이머가 끝나기 전까지 100점을 넘기면 성공~</li>
		</ul>
		<button onclick="startGame()">> 게임 시작하기 <</button>
	</div>
	<div id="gameUI">
	    <div id="timer">TIME 30</div>
	    <div id="hearts">
	      <img src="heart.png"><img src="heart.png"><img src="heart.png">
	    </div>
	    <img src="cat.jpg" id="cat">
	</div>

	<script>
        let time = 30, timerInterval, spawnInterval, score = 0, lives = 3;
		const fishList = ["fish_o.png","fish_w.png","fish_g.png"];
		const obstacleList = ["bottle.png","obstacle.png","rock.png","trash.png","headphone.png","clock.png","chair.png","plastic.png"];
        let gameActive = false;
        let isPaused = false; // 팝업 동안 일시정지 상태
		let isJumping = false;
	  
		// 좌우 50px 가드라인
		const LEFT_MARGIN = 50;
		const RIGHT_MARGIN = 50;
	  
		function renderRules(){
		  const popup = document.getElementById("rulePopup");
		  popup.innerHTML = `
			<h2>!Rule!</h2>
			<ul>
			  <li>방향키(←, →)와 스페이스바로 야옹이를 조작할 수 있다.</li>
			  <li>떨어지는 생선을 먹으면 점수를 얻는다.</li>
			  <li>그러나 플라스틱 병이나 쓰레기는 먹으면 하트가 깎임!</li>
			  <li>우측 상단 타이머가 끝나기 전까지 100점을 넘기면 성공~</li>
			</ul>
			<button onclick="startGame()">&gt; 게임 시작하기 &lt;</button>
		  `;
		}
	  
		function showRules(){
		  if (gameActive) return;
		  renderRules();
		  document.getElementById("overlay").style.display = "block";
		  document.getElementById("rulePopup").style.display = "block";
		}
	  
		function startGame(){
		  gameActive = true;
		  score = 0; lives = 3; time = 30;
	  
		  document.getElementById("overlay").style.display = "none";
		  document.getElementById("rulePopup").style.display = "none";
	  
		  const title = document.getElementById("title");
		  title.style.fontSize = "2rem";
		  title.style.transform = "translateY(-50px)";
		  const subtitle = document.querySelector("h3");
          if (subtitle) subtitle.style.display = "none";
		  
	  
		  document.getElementById("startCat").style.display = "none";
		  document.getElementById("gameUI").style.display = "block";
		  document.getElementById("hearts").innerHTML = '<img src="heart.png"><img src="heart.png"><img src="heart.png">';
	  
		  const cat = document.getElementById("cat");
		  // ⚠️ 게임 중에는 translateX 사용 안 함 (경계 계산 꼬임 방지)
		  const centerLeft = (window.innerWidth - cat.offsetWidth) / 2;
		  cat.style.left = centerLeft + "px";
		  cat.style.transform = "scaleX(1)";
		  cat.style.bottom = "130px";
	  
		  document.getElementById("timer").innerText = "TIME " + time;
		  timerInterval = setInterval(() => {
			time--;
			document.getElementById("timer").innerText = "TIME " + (time < 10 ? "0"+time : time);
			if (time <= 0) endGame();
		  }, 1000);
	  
		  spawnInterval = setInterval(spawnItem, 1000);
	  
		  document.addEventListener("keydown", handleKeyDown);
		}
	  
		function handleKeyDown(e){
		  if (!gameActive) return;
	  
		  // 스크롤 방지
		  if (["ArrowLeft","ArrowRight"," "].includes(e.key)) e.preventDefault();
	  
		  const cat = document.getElementById("cat");
		  let left = cat.offsetLeft;
		  const step = 40;
	  
		  // 스페이스 점프(동시에 방향키도 먹히도록 return 금지)
		  if (e.key === " ") {
			jumpCat();
		  }
	  
		  // 좌우 경계(50px~windowWidth-50px-catWidth)
		  const minX = LEFT_MARGIN;
		  const maxX = window.innerWidth - RIGHT_MARGIN - cat.offsetWidth;
	  
		  if (e.key === "ArrowLeft"){
			const next = Math.max(minX, left - step);
			cat.style.left = next + "px";
			cat.style.transform = "scaleX(-1)";
		  }
		  if (e.key === "ArrowRight"){
			const next = Math.min(maxX, left + step);
			cat.style.left = next + "px";
			cat.style.transform = "scaleX(1)";
		  }
		}
	  
		function jumpCat(){
		  if (isJumping) return;
		  isJumping = true;
		  const cat = document.getElementById("cat");
		  const start = parseInt(getComputedStyle(cat).bottom) || 100;
		  const peak = start + 150;
		  let up = setInterval(()=>{
			let b = parseInt(getComputedStyle(cat).bottom) || start;
			if (b >= peak) {
			  clearInterval(up);
			  let down = setInterval(()=>{
				b = parseInt(getComputedStyle(cat).bottom) || peak;
				if (b <= start){
				  cat.style.bottom = start + "px";
				  clearInterval(down);
				  isJumping = false;
				} else {
				  cat.style.bottom = (b - 15) + "px";
				}
			  }, 16);
			} else {
			  cat.style.bottom = (b + 15) + "px";
			}
		  }, 16);
		}
	  
        function spawnItem(){
		  if (!gameActive) return;
		  const item = document.createElement("img");
		  const isFish = Math.random() < 0.5;
		  item.src = isFish ? fishList[Math.floor(Math.random()*fishList.length)]
							: obstacleList[Math.floor(Math.random()*obstacleList.length)];
		  item.className = "item";
		  item.style.left = Math.floor(Math.random() * (window.innerWidth - 80)) + "px";
		  document.body.appendChild(item);
	  
		  const fallSpeed = Math.random() * 5 + 5; // 5~10
          const fall = setInterval(()=>{
            // 게임 종료 시에는 인터벌 종료 및 요소 제거
            if (!gameActive){ item.remove(); clearInterval(fall); return; }
            // 일시정지 중에는 이동만 멈춤
            if (isPaused) { return; }
			item.style.top = (item.offsetTop + fallSpeed) + "px";
			if (checkCollision(item)){
			  if (isFish) { score += 10; }
              else { loseHeart(item.src || ""); }
			  item.remove(); clearInterval(fall);
			}
			if (item.offsetTop > window.innerHeight){
			  item.remove(); clearInterval(fall);
			}
		  }, 50);
		}
	  
		function checkCollision(item){
		  const cat = document.getElementById("cat").getBoundingClientRect();
		  const obj = item.getBoundingClientRect();
		  return !(cat.right < obj.left || cat.left > obj.right || cat.bottom < obj.top || cat.top > obj.bottom);
		}
	  
        function loseHeart(itemSrc){
		  const hearts = document.querySelectorAll("#hearts img");
		  if (hearts[lives-1]) hearts[lives-1].remove();
		  lives--;
          if (lives <= 0) { endGame(); return; }
          showTrashPopup(itemSrc);
		}

        function pauseGame(){
          if (!gameActive) return;
          if (isPaused) return;
          isPaused = true;
          if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
          if (spawnInterval) { clearInterval(spawnInterval); spawnInterval = null; }
        }

        function resumeGame(){
          if (!gameActive) return; // 게임이 종료된 경우는 재개하지 않음
          if (!isPaused) return;
          isPaused = false;
          // 재개: 타이머 재가동
          document.getElementById("timer").innerText = "TIME " + (time < 10 ? "0"+time : time);
          timerInterval = setInterval(() => {
            if (isPaused) return; // 혹시 중간에 다시 일시정지되면 카운트 중단
            time--;
            document.getElementById("timer").innerText = "TIME " + (time < 10 ? "0"+time : time);
            if (time <= 0) endGame();
          }, 1000);
          // 아이템 스폰 재개
          spawnInterval = setInterval(spawnItem, 1000);
        }

        function getTrashNameFromSrc(src){
          try {
            const file = src.split('/').pop();
            if (file === 'headphone.png') return '헤드셋을';
            if (file === 'plastic.png') return '비닐봉지를';
            if (file === 'bottle.png') return '페트병을';
            if (file === 'rock.png') return '돌을';
            if (file === 'obstacle.png') return '장애물을';
            if (file === 'clock.png') return '시계를';
            if (file === 'chair.png') return '의자를';
            if (file === 'trash.png') return '쓰레기통을';
          } catch(e) {}
          return '쓰레기';
        }

        function showTrashPopup(itemSrc){
          pauseGame();
          const name = getTrashNameFromSrc(itemSrc);
          document.getElementById("overlay").style.display = "block";
          const popup = document.getElementById("rulePopup");
          popup.style.display = "block";
          popup.innerHTML = `
            <h2>아이코!</h2>
            <p style="font-size:0.9rem;text-align:center;">인간이 버린 ${name} 먹어버렸어요!<br>야옹이가 쓰레기를 먹으면 아프니 주의해주세요.</p>
            <button onclick="closeTrashPopup()">&gt; 계속하기 &lt;</button>
          `;
        }

        function closeTrashPopup(){
          document.getElementById("overlay").style.display = "none";
          document.getElementById("rulePopup").style.display = "none";
          resumeGame();
        }
	  
		function endGame(){
		  gameActive = false;
		  clearInterval(timerInterval);
		  clearInterval(spawnInterval);
		  document.removeEventListener("keydown", handleKeyDown);
		  document.querySelectorAll(".item").forEach(el => el.remove());
	  
		  document.getElementById("overlay").style.display = "block";
		  const popup = document.getElementById("rulePopup");
		  popup.style.display = "block";
	  
		  const resultHtml = (score >= 100 && lives > 0)
			? `<h2>GAME CLEAR!</h2><p style="font-size:0.9rem;text-align:center;">내 점수: ${score}점<br> 앞으로도 야옹이가 인간이 버린 쓰레기를 <br>먹지 않도록 분리수거를 잘 해주세요!</p>`
			: `<h2>GAME OVER :(</h2><p style="font-size:0.9rem;text-align:center;">내 점수: ${score}점<br> 인간이 마구잡이로 버린 쓰레기 때문에 <br>야옹이가 아파요. 환경을 지켜주세요!</p>`;
	  
		  popup.innerHTML = `
			${resultHtml}
			<div style="display:flex; justify-content:center; gap:20px; margin-top:40px;">
			  <button style="margin:0;" onclick="backToMenu()">&gt; 메뉴로 이동 &lt;</button>
			  <button style="margin:0;" onclick="startGame()">&gt; 다시 하기 &lt;</button>
			</div>
		  `;
		}
	  
		function backToMenu(){
		  clearInterval(timerInterval);
		  clearInterval(spawnInterval);
		  document.removeEventListener("keydown", handleKeyDown);
		  document.querySelectorAll(".item").forEach(el => el.remove());
		  gameActive = false;
		  isJumping = false;
	  
		  document.getElementById("overlay").style.display = "none";
		  renderRules();
		  document.getElementById("rulePopup").style.display = "none";
	  
		  const title = document.getElementById("title");
		  title.style.fontSize = "4rem";
		  title.style.transform = "translateY(0)";
		  document.getElementById("startCat").style.display = "inline";
		  document.getElementById("gameUI").style.display = "none";
	  
		  score = 0; lives = 3; time = 30;
		  document.getElementById("hearts").innerHTML = '<img src="heart.png"><img src="heart.png"><img src="heart.png">';
		  document.getElementById("timer").innerText = "TIME 30";
	  
		  // 대기 화면에서는 다시 중앙 정렬(초기 디자인 유지)
		  const cat = document.getElementById("cat");
		  cat.style.left = "50%";
		  cat.style.transform = "translateX(-50%)";
		}
	  
		// 초기 룰 채우기
		renderRules();
	  </script>
	  


</body>
</html>
